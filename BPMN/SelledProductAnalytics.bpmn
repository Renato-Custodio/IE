<?xml version="1.0" encoding="UTF-8"?>
<ns2:definitions xmlns:ns2="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:ns3="http://www.omg.org/spec/DD/20100524/DI" xmlns:ns4="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:ns5="http://www.omg.org/spec/DD/20100524/DC" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:modeler="http://camunda.org/schema/modeler/1.0" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.35.0" modeler:executionPlatform="Camunda Platform" modeler:executionPlatformVersion="7.23.0">
  <ns2:collaboration id="coll-DEMO2BPMN">
    <ns2:participant id="Participant_7482ecae-f244-4807-afd9-1c1ec6bd91de" name="BUSINESS ACTOR" processRef="ShopManagementCreation" />
  </ns2:collaboration>
  <ns2:process id="ShopManagementCreation" name="ShopManagement" isExecutable="true" camunda:historyTimeToLive="180">
    <ns2:laneSet id="LaneSet_9dd354d5-3637-4087-8e77-b95490547d1f">
      <ns2:lane id="Lane_815a5e53-d02a-41cc-a324-313a0892a456" name="New Shop - Initiator TK01">
        <ns2:flowNodeRef>Event_87d8e39a-5282-4686-90b2-6ba5adc51c49</ns2:flowNodeRef>
        <ns2:flowNodeRef>Activity_9841ec7e-705e-4a46-9924-61aed9dc6c00</ns2:flowNodeRef>
        <ns2:flowNodeRef>Activity_8a65cc5c-3044-4a2b-a08e-58c41cc97372</ns2:flowNodeRef>
        <ns2:flowNodeRef>Activity_096isg2</ns2:flowNodeRef>
        <ns2:flowNodeRef>Activity_1x3qvd8</ns2:flowNodeRef>
        <ns2:flowNodeRef>Activity_1u2sw5b</ns2:flowNodeRef>
        <ns2:flowNodeRef>Gateway_0wz6b3i</ns2:flowNodeRef>
        <ns2:flowNodeRef>Activity_0ot30iv</ns2:flowNodeRef>
        <ns2:flowNodeRef>Activity_0pso3d6</ns2:flowNodeRef>
        <ns2:flowNodeRef>Event_1d8jmrm</ns2:flowNodeRef>
        <ns2:flowNodeRef>Activity_1itw1y6</ns2:flowNodeRef>
        <ns2:flowNodeRef>Event_fa44b575-5992-40f8-b464-09f8917512bd</ns2:flowNodeRef>
      </ns2:lane>
    </ns2:laneSet>
    <ns2:startEvent id="Event_87d8e39a-5282-4686-90b2-6ba5adc51c49">
      <ns2:outgoing>Flow_b7f55062-b030-4698-b662-4bb756a2fea9</ns2:outgoing>
    </ns2:startEvent>
    <ns2:userTask id="Activity_9841ec7e-705e-4a46-9924-61aed9dc6c00" name="Decide the Purchase to analyse" camunda:assignee="demo">
      <ns2:extensionElements>
        <camunda:formData>
          <camunda:formField id="PurchaseID" label="PurchaseID" type="string" />
        </camunda:formData>
      </ns2:extensionElements>
      <ns2:incoming>Flow_1i387c7</ns2:incoming>
      <ns2:outgoing>Flow_0xj53km</ns2:outgoing>
    </ns2:userTask>
    <ns2:serviceTask id="Activity_8a65cc5c-3044-4a2b-a08e-58c41cc97372" name="Retrieve Purchases Catalog">
      <ns2:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="method">GET</camunda:inputParameter>
            <camunda:inputParameter name="url">http://&lt;KONG_URL&gt;:8000/purchase</camunda:inputParameter>
            <camunda:outputParameter name="PurchaseList">
              <camunda:script scriptFormat="JavaScript">S(connector.getVariable("response"));</camunda:script>
            </camunda:outputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>http-connector</camunda:connectorId>
        </camunda:connector>
      </ns2:extensionElements>
      <ns2:incoming>Flow_b7f55062-b030-4698-b662-4bb756a2fea9</ns2:incoming>
      <ns2:outgoing>Flow_1i387c7</ns2:outgoing>
    </ns2:serviceTask>
    <ns2:sequenceFlow id="Flow_b7f55062-b030-4698-b662-4bb756a2fea9" sourceRef="Event_87d8e39a-5282-4686-90b2-6ba5adc51c49" targetRef="Activity_8a65cc5c-3044-4a2b-a08e-58c41cc97372" />
    <ns2:sequenceFlow id="Flow_1i387c7" sourceRef="Activity_8a65cc5c-3044-4a2b-a08e-58c41cc97372" targetRef="Activity_9841ec7e-705e-4a46-9924-61aed9dc6c00" />
    <ns2:sequenceFlow id="Flow_0xj53km" sourceRef="Activity_9841ec7e-705e-4a46-9924-61aed9dc6c00" targetRef="Activity_0ot30iv" />
    <ns2:serviceTask id="Activity_1x3qvd8" name="Retrieve ShopLocation by ShopName">
      <ns2:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="method">GET</camunda:inputParameter>
            <camunda:inputParameter name="url">http://&lt;KONG_URL&gt;:8000/shop/name/${ShopName}</camunda:inputParameter>
            <camunda:outputParameter name="ShopLocation">
              <camunda:script scriptFormat="JavaScript">S(connector.getVariable("response")).jsonPath("location").stringValue();</camunda:script>
            </camunda:outputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>http-connector</camunda:connectorId>
        </camunda:connector>
      </ns2:extensionElements>
      <ns2:incoming>Flow_0qnn8qi</ns2:incoming>
      <ns2:outgoing>Flow_17sojbx</ns2:outgoing>
    </ns2:serviceTask>
    <ns2:userTask id="Activity_1u2sw5b" name="Verify all data to be analysed">
      <ns2:extensionElements>
        <camunda:formData>
          <camunda:formField id="LooksGood" label="LooksGood" type="boolean" />
        </camunda:formData>
      </ns2:extensionElements>
      <ns2:incoming>Flow_17sojbx</ns2:incoming>
      <ns2:outgoing>Flow_0qzs2j3</ns2:outgoing>
    </ns2:userTask>
    <ns2:exclusiveGateway id="Gateway_0wz6b3i">
      <ns2:incoming>Flow_0qzs2j3</ns2:incoming>
      <ns2:outgoing>Flow_0k3jxe9</ns2:outgoing>
      <ns2:outgoing>Flow_0yjlf4h</ns2:outgoing>
    </ns2:exclusiveGateway>
    <ns2:sequenceFlow id="Flow_0qnn8qi" sourceRef="Activity_096isg2" targetRef="Activity_1x3qvd8" />
    <ns2:sequenceFlow id="Flow_17sojbx" sourceRef="Activity_1x3qvd8" targetRef="Activity_1u2sw5b" />
    <ns2:sequenceFlow id="Flow_0qzs2j3" sourceRef="Activity_1u2sw5b" targetRef="Gateway_0wz6b3i" />
    <ns2:sequenceFlow id="Flow_0k3jxe9" name="yes" sourceRef="Gateway_0wz6b3i" targetRef="Activity_0pso3d6">
      <ns2:conditionExpression xsi:type="ns2:tFormalExpression">${LooksGood}</ns2:conditionExpression>
    </ns2:sequenceFlow>
    <ns2:sequenceFlow id="Flow_0yjlf4h" name="no" sourceRef="Gateway_0wz6b3i" targetRef="Event_1d8jmrm">
      <ns2:conditionExpression xsi:type="ns2:tFormalExpression">${!LooksGood}</ns2:conditionExpression>
    </ns2:sequenceFlow>
    <ns2:sequenceFlow id="Flow_1g2roik" sourceRef="Activity_1itw1y6" targetRef="Event_fa44b575-5992-40f8-b464-09f8917512bd" />
    <ns2:sequenceFlow id="Flow_1ilzust" sourceRef="Activity_0pso3d6" targetRef="Activity_1itw1y6" />
    <ns2:serviceTask id="Activity_0ot30iv" name="Retrieve Purchase data By Id">
      <ns2:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="method">GET</camunda:inputParameter>
            <camunda:inputParameter name="url">http://&lt;KONG_URL&gt;:8000/purchase/${PurchaseID}</camunda:inputParameter>
            <camunda:outputParameter name="LoyaltyCardID">
              <camunda:script scriptFormat="JavaScript">S(connector.getVariable("response")).jsonPath("loyaltyCardId").stringValue();</camunda:script>
            </camunda:outputParameter>
            <camunda:outputParameter name="ShopName">
              <camunda:script scriptFormat="JavaScript">S(connector.getVariable("response")).jsonPath("shopName").stringValue();</camunda:script>
            </camunda:outputParameter>
            <camunda:outputParameter name="DiscountCouponID">
              <camunda:script scriptFormat="JavaScript">S(connector.getVariable("response")).jsonPath("discountCouponId").stringValue();</camunda:script>
            </camunda:outputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>http-connector</camunda:connectorId>
        </camunda:connector>
      </ns2:extensionElements>
      <ns2:incoming>Flow_0xj53km</ns2:incoming>
      <ns2:outgoing>Flow_1pw8wr8</ns2:outgoing>
    </ns2:serviceTask>
    <ns2:sequenceFlow id="Flow_1pw8wr8" sourceRef="Activity_0ot30iv" targetRef="Activity_096isg2" />
    <ns2:serviceTask id="Activity_096isg2" name="Retrieve CustomerID through LoyaltyCard">
      <ns2:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="method">GET</camunda:inputParameter>
            <camunda:inputParameter name="url">http://&lt;KONG_URL&gt;:8000/loyaltyCard/${LoyaltyCardID}</camunda:inputParameter>
            <camunda:outputParameter name="CustomerID">
              <camunda:script scriptFormat="JavaScript">S(connector.getVariable("response")).jsonPath("idCustomer").stringValue();</camunda:script>
            </camunda:outputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>http-connector</camunda:connectorId>
        </camunda:connector>
      </ns2:extensionElements>
      <ns2:incoming>Flow_1pw8wr8</ns2:incoming>
      <ns2:outgoing>Flow_0qnn8qi</ns2:outgoing>
    </ns2:serviceTask>
    <ns2:serviceTask id="Activity_0pso3d6" name="Create SelledProductAnalytics">
      <ns2:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="payload">{
    "idLoyaltyCard": "${LoyaltyCardID}" ,
    "shopName": "${ShopName}",
    "idCoupon": "${DiscountCouponID}" ,
    "idPurchase": "${PurchaseID}",
    "idCustomer": "${CustomerID}",
    "location": "${ShopLocation}"
}</camunda:inputParameter>
            <camunda:inputParameter name="method">POST</camunda:inputParameter>
            <camunda:inputParameter name="url">http://&lt;KONG_URL&gt;:8000/selledProductAnalytics</camunda:inputParameter>
            <camunda:inputParameter name="headers">
              <camunda:map>
                <camunda:entry key="accept">application/json</camunda:entry>
                <camunda:entry key="Content-Type">application/json</camunda:entry>
              </camunda:map>
            </camunda:inputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>http-connector</camunda:connectorId>
        </camunda:connector>
      </ns2:extensionElements>
      <ns2:incoming>Flow_0k3jxe9</ns2:incoming>
      <ns2:outgoing>Flow_1ilzust</ns2:outgoing>
    </ns2:serviceTask>
    <ns2:endEvent id="Event_1d8jmrm">
      <ns2:incoming>Flow_0yjlf4h</ns2:incoming>
    </ns2:endEvent>
    <ns2:userTask id="Activity_1itw1y6" name="Verify SelledProductAnalytics">
      <ns2:extensionElements>
        <camunda:formData>
          <camunda:formField id="Successful" label="Successful" type="boolean" />
        </camunda:formData>
      </ns2:extensionElements>
      <ns2:incoming>Flow_1ilzust</ns2:incoming>
      <ns2:outgoing>Flow_1g2roik</ns2:outgoing>
    </ns2:userTask>
    <ns2:endEvent id="Event_fa44b575-5992-40f8-b464-09f8917512bd">
      <ns2:incoming>Flow_1g2roik</ns2:incoming>
    </ns2:endEvent>
  </ns2:process>
  <ns4:BPMNDiagram id="diagram-DEMO2BPMN">
    <ns4:BPMNPlane xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" id="plane-DEMO2BPMN" bpmnElement="coll-DEMO2BPMN">
      <ns4:BPMNShape id="Participant_7482ecae-f244-4807-afd9-1c1ec6bd91de_di" bpmnElement="Participant_7482ecae-f244-4807-afd9-1c1ec6bd91de" isHorizontal="true">
        <ns5:Bounds x="180" y="50" width="1740" height="340" />
        <ns4:BPMNLabel />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="Lane_815a5e53-d02a-41cc-a324-313a0892a456_di" bpmnElement="Lane_815a5e53-d02a-41cc-a324-313a0892a456" isHorizontal="true">
        <ns5:Bounds x="210" y="50" width="1710" height="340" />
        <ns4:BPMNLabel />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="Event_05rjfxm_di" bpmnElement="Event_87d8e39a-5282-4686-90b2-6ba5adc51c49">
        <ns5:Bounds x="261" y="117" width="36" height="36" />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="Activity_194vcwc_di" bpmnElement="Activity_9841ec7e-705e-4a46-9924-61aed9dc6c00">
        <ns5:Bounds x="529" y="95" width="100" height="80" />
        <ns4:BPMNLabel />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="Activity_1rhs2ng_di" bpmnElement="Activity_8a65cc5c-3044-4a2b-a08e-58c41cc97372" bioc:stroke="#831311" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#831311">
        <ns5:Bounds x="359" y="95" width="100" height="80" />
        <ns4:BPMNLabel />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="BPMNShape_0lkt4ow" bpmnElement="Activity_1x3qvd8" bioc:stroke="#831311" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#831311">
        <ns5:Bounds x="990" y="95" width="100" height="80" />
        <ns4:BPMNLabel />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="Activity_03vq8zq_di" bpmnElement="Activity_1u2sw5b">
        <ns5:Bounds x="1150" y="95" width="100" height="80" />
        <ns4:BPMNLabel />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="Gateway_0wz6b3i_di" bpmnElement="Gateway_0wz6b3i" isMarkerVisible="true">
        <ns5:Bounds x="1335" y="110" width="50" height="50" />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="BPMNShape_036kbx0" bpmnElement="Activity_0ot30iv" bioc:stroke="#831311" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#831311">
        <ns5:Bounds x="680" y="95" width="100" height="80" />
        <ns4:BPMNLabel />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="BPMNShape_1seu0su" bpmnElement="Activity_096isg2" bioc:stroke="#831311" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#831311">
        <ns5:Bounds x="829" y="95" width="100" height="80" />
        <ns4:BPMNLabel />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="BPMNShape_0ziinsq" bpmnElement="Activity_0pso3d6" bioc:stroke="#831311" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#831311">
        <ns5:Bounds x="1470" y="95" width="100" height="80" />
        <ns4:BPMNLabel />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="Event_1d8jmrm_di" bpmnElement="Event_1d8jmrm">
        <ns5:Bounds x="1502" y="232" width="36" height="36" />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="Activity_0dkhzai_di" bpmnElement="Activity_1itw1y6">
        <ns5:Bounds x="1660" y="95" width="100" height="80" />
        <ns4:BPMNLabel />
      </ns4:BPMNShape>
      <ns4:BPMNShape id="Event_fa44b575-5992-40f8-b464-09f8917512bd_di" bpmnElement="Event_fa44b575-5992-40f8-b464-09f8917512bd">
        <ns5:Bounds x="1842" y="117" width="36" height="36" />
        <ns4:BPMNLabel>
          <ns5:Bounds x="1027" y="153" width="24" height="14" />
        </ns4:BPMNLabel>
      </ns4:BPMNShape>
      <ns4:BPMNEdge id="Edge_d3f0c9f6-16e9-40b8-b7ae-706f1e5298a0" bpmnElement="Flow_b7f55062-b030-4698-b662-4bb756a2fea9">
        <ns3:waypoint x="297" y="135" />
        <ns3:waypoint x="359" y="135" />
      </ns4:BPMNEdge>
      <ns4:BPMNEdge id="Flow_1i387c7_di" bpmnElement="Flow_1i387c7">
        <ns3:waypoint x="459" y="135" />
        <ns3:waypoint x="529" y="135" />
      </ns4:BPMNEdge>
      <ns4:BPMNEdge id="Flow_0xj53km_di" bpmnElement="Flow_0xj53km">
        <ns3:waypoint x="629" y="135" />
        <ns3:waypoint x="680" y="135" />
      </ns4:BPMNEdge>
      <ns4:BPMNEdge id="Flow_0qnn8qi_di" bpmnElement="Flow_0qnn8qi">
        <ns3:waypoint x="929" y="135" />
        <ns3:waypoint x="990" y="135" />
      </ns4:BPMNEdge>
      <ns4:BPMNEdge id="Flow_17sojbx_di" bpmnElement="Flow_17sojbx">
        <ns3:waypoint x="1090" y="135" />
        <ns3:waypoint x="1150" y="135" />
      </ns4:BPMNEdge>
      <ns4:BPMNEdge id="Flow_0qzs2j3_di" bpmnElement="Flow_0qzs2j3">
        <ns3:waypoint x="1250" y="135" />
        <ns3:waypoint x="1335" y="135" />
      </ns4:BPMNEdge>
      <ns4:BPMNEdge id="Flow_0k3jxe9_di" bpmnElement="Flow_0k3jxe9">
        <ns3:waypoint x="1385" y="135" />
        <ns3:waypoint x="1470" y="135" />
        <ns4:BPMNLabel>
          <ns5:Bounds x="1395" y="117" width="18" height="14" />
        </ns4:BPMNLabel>
      </ns4:BPMNEdge>
      <ns4:BPMNEdge id="Flow_0yjlf4h_di" bpmnElement="Flow_0yjlf4h">
        <ns3:waypoint x="1360" y="160" />
        <ns3:waypoint x="1360" y="250" />
        <ns3:waypoint x="1502" y="250" />
        <ns4:BPMNLabel>
          <ns5:Bounds x="1373" y="193" width="13" height="14" />
        </ns4:BPMNLabel>
      </ns4:BPMNEdge>
      <ns4:BPMNEdge id="Flow_1g2roik_di" bpmnElement="Flow_1g2roik">
        <ns3:waypoint x="1760" y="135" />
        <ns3:waypoint x="1842" y="135" />
      </ns4:BPMNEdge>
      <ns4:BPMNEdge id="Flow_1ilzust_di" bpmnElement="Flow_1ilzust">
        <ns3:waypoint x="1570" y="135" />
        <ns3:waypoint x="1660" y="135" />
      </ns4:BPMNEdge>
      <ns4:BPMNEdge id="Flow_1pw8wr8_di" bpmnElement="Flow_1pw8wr8">
        <ns3:waypoint x="780" y="135" />
        <ns3:waypoint x="829" y="135" />
      </ns4:BPMNEdge>
    </ns4:BPMNPlane>
  </ns4:BPMNDiagram>
</ns2:definitions>
